<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Akun Saya</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<script src="assets/js/guard.js"></script>
<script src="assets/js/navbar.js"></script>

<div class="max-w-4xl mx-auto p-6 mt-6">
  <h1 class="text-2xl font-semibold mb-6">Akun Saya</h1>

  <div class="bg-white p-6 rounded shadow space-y-6">
    <!-- FOTO PROFIL -->
<div class="flex items-center gap-4">
  <img id="profileImage"
       src="https://via.placeholder.com/100"
       class="w-24 h-24 rounded-full object-cover border">

  <div>
    <input type="file" id="uploadPhoto" class="hidden" accept="image/*">
    <button id="changePhotoBtn"
      class="bg-gray-200 px-4 py-2 rounded text-sm">
      Ganti Foto
    </button>
  </div>
</div>

    <!-- INFO UMUM -->
    <div>
      <p class="text-sm text-gray-500">Nama</p>
      <p id="namaDisplay" class="font-medium"></p>
    </div>

    <div>
      <p class="text-sm text-gray-500">Email</p>
      <p id="emailDisplay" class="font-medium"></p>
    </div>

    <div>
      <p class="text-sm text-gray-500">Role</p>
      <p id="roleDisplay" class="font-medium capitalize"></p>
    </div>


    <!-- ADMIN SECTION -->
    <div id="adminSection" class="hidden space-y-4 border-t pt-4">

      <h2 class="text-lg font-semibold">Statistik Admin</h2>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">

        <div class="bg-gray-100 p-4 rounded">
          <p class="text-sm text-gray-500">Total User</p>
          <p id="totalUser" class="text-xl font-semibold">0</p>
        </div>

        <div class="bg-gray-100 p-4 rounded">
          <p class="text-sm text-gray-500">Total Materi</p>
          <p id="totalMateri" class="text-xl font-semibold">0</p>
        </div>

        <div class="bg-gray-100 p-4 rounded">
          <p class="text-sm text-gray-500">Total Presensi</p>
          <p id="totalPresensi" class="text-xl font-semibold">0</p>
        </div>

      </div>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="flex gap-3 pt-4 border-t">
      <button id="editProfileBtn"
        class="bg-blue-600 text-white px-4 py-2 rounded">
        Edit Profil
      </button>

      <button onclick="logout()"
        class="bg-red-600 text-white px-4 py-2 rounded">
        Logout
      </button>
    </div>

  </div>
</div>

<!-- MODAL EDIT -->
<div id="editModal" class="fixed inset-0 bg-black bg-opacity-40 hidden flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow w-96 space-y-4">
    <h2 class="text-lg font-semibold">Edit Profil</h2>

    <input id="editNama" class="border p-2 w-full" placeholder="Nama">
    <input id="editEmail" class="border p-2 w-full" placeholder="Email">

    <div class="flex justify-end gap-2">
      <button id="cancelEdit" class="px-4 py-2 bg-gray-300 rounded">Batal</button>
      <button id="saveEdit" class="px-4 py-2 bg-blue-600 text-white rounded">Simpan</button>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {

  const role = localStorage.getItem("role") || "siswa";
  let email = localStorage.getItem("email") || "-";
  let nama = localStorage.getItem("nama") || "User";

  document.getElementById("emailDisplay").textContent = email;
  document.getElementById("roleDisplay").textContent = role;
  document.getElementById("namaDisplay").textContent = nama;

  // ADMIN STAT
  if (role === "admin") {
    document.getElementById("adminSection").classList.remove("hidden");

    const users = JSON.parse(localStorage.getItem("userData")) || [];
    const materi = JSON.parse(localStorage.getItem("materiData")) || [];
    const presensi = JSON.parse(localStorage.getItem("presensiData")) || [];

    document.getElementById("totalUser").textContent = users.length;
    document.getElementById("totalMateri").textContent = materi.length;
    document.getElementById("totalPresensi").textContent = presensi.length;
  }

  const modal = document.getElementById("editModal");
  const editNama = document.getElementById("editNama");
  const editEmail = document.getElementById("editEmail");

  document.getElementById("editProfileBtn").addEventListener("click", function() {
    editNama.value = nama;
    editEmail.value = email;
    modal.classList.remove("hidden");
  });

  document.getElementById("cancelEdit").addEventListener("click", function() {
    modal.classList.add("hidden");
  });

  document.getElementById("saveEdit").addEventListener("click", function() {

    if (!editNama.value || !editEmail.value) {
      alert("Semua field wajib diisi");
      return;
    }

    nama = editNama.value;
    email = editEmail.value;

    localStorage.setItem("nama", nama);
    localStorage.setItem("email", email);

    document.getElementById("namaDisplay").textContent = nama;
    document.getElementById("emailDisplay").textContent = email;

    modal.classList.add("hidden");
    alert("Profil berhasil diperbarui");
  });

});
  // ================= FOTO PROFIL =================
const profileImage = document.getElementById("profileImage");
const uploadPhoto = document.getElementById("uploadPhoto");
const changePhotoBtn = document.getElementById("changePhotoBtn");

// Load foto jika ada
const savedPhoto = localStorage.getItem("profilePhoto");
if (savedPhoto) {
  profileImage.src = savedPhoto;
}

changePhotoBtn.addEventListener("click", function() {
  uploadPhoto.click();
});

uploadPhoto.addEventListener("change", function() {

  const file = uploadPhoto.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    profileImage.src = e.target.result;
    localStorage.setItem("profilePhoto", e.target.result);
  };

  reader.readAsDataURL(file);
});

</script>

<script src="assets/js/auth.js"></script>

</body>
</html>
