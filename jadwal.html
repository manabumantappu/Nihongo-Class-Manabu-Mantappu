<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Jadwal</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100">

<!-- ðŸ” GUARD PALING ATAS -->
<script src="assets/js/guard.js"></script>

<!-- ðŸ§­ NAVBAR GLOBAL -->
<script src="assets/js/navbar.js"></script>

<div class="max-w-6xl mx-auto p-6 mt-6">
  <h1 class="text-xl font-semibold mb-6">Jadwal Kelas</h1>
<!-- FORM TAMBAH JADWAL (ADMIN ONLY) -->
<div id="formContainer" class="bg-white p-4 rounded-xl shadow mb-6 hidden">
  <h2 class="font-semibold mb-4">Tambah Jadwal</h2>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">

    <select id="hariInput" class="border p-2 rounded">
      <option value="">Pilih Hari</option>
      <option>Senin</option>
      <option>Selasa</option>
      <option>Rabu</option>
      <option>Kamis</option>
      <option>Jumat</option>
      <option>Sabtu</option>
      <option>Minggu</option>
    </select>

    <input id="jamInput" type="text" placeholder="09:00 - 11:00"
      class="border p-2 rounded">

    <input id="levelInput" type="text" placeholder="N5 / N4 / N3"
      class="border p-2 rounded">

    <input id="pengajarInput" type="text" placeholder="Nama Sensei"
      class="border p-2 rounded">

  </div>

  <button onclick="tambahJadwal()"
    class="mt-4 bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
    Simpan Jadwal
  </button>
</div>

  <div class="overflow-x-auto bg-white rounded-xl shadow">
    <table class="min-w-full table-fixed text-sm">
      
      <thead class="bg-gray-100">
  <tr>
    <th class="p-3 text-left w-1/5">Hari</th>
    <th class="p-3 text-center w-1/5">Jam</th>
    <th class="p-3 text-center w-1/5">Level</th>
    <th class="p-3 text-center w-1/5">Pengajar</th>
    <th class="p-3 text-center w-1/5" id="aksiHeader">Aksi</th>
  </tr>
</thead>
      <tbody id="jadwalBody" class="divide-y divide-gray-200">
        <!-- Data Firebase akan masuk di sini -->
      </tbody>

    </table>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { 
  getFirestore, 
  collection, 
  getDocs,
  addDoc,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

// ================= FIREBASE CONFIG =================
const firebaseConfig = {
  apiKey: "AIzaSyDWe_8KQh5J5gzgKYDWnzNKiw-y1Vj3908",
  authDomain: "jp-nihongo-class.firebaseapp.com",
  projectId: "jp-nihongo-class",
  storageBucket: "jp-nihongo-class.firebasestorage.app",
  messagingSenderId: "102563702284",
  appId: "1:102563702284:web:9a5166a4f7450127647029"
};

// ================= INIT =================
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const jadwalRef = collection(db, "Jadwal");

const role = localStorage.getItem("role");
// ================= URUTAN HARI =================
const urutanHari = {
  "Senin": 1,
  "Selasa": 2,
  "Rabu": 3,
  "Kamis": 4,
  "Jumat": 5,
  "Sabtu": 6,
  "Minggu": 7
};

// ================= TAMPILKAN FORM ADMIN =================
if (role === "admin") {
  document.getElementById("formContainer").classList.remove("hidden");
} else {
  document.getElementById("aksiHeader").style.display = "none";
}

// ================= LOAD DATA =================
async function loadJadwal() {
  const snapshot = await getDocs(jadwalRef);
  const tbody = document.getElementById("jadwalBody");
  tbody.innerHTML = "";

  let dataList = [];

  snapshot.forEach((item) => {
    const data = item.data();
    dataList.push({
      id: item.id,
      ...data
    });
  });

  // ðŸ”¥ SORT berdasarkan hari
  dataList.sort((a, b) => {
    return (urutanHari[a.hari] || 99) - (urutanHari[b.hari] || 99);
  });

  // Render setelah diurutkan
  dataList.forEach((data) => {
    tbody.innerHTML += `
      <tr class="hover:bg-gray-50">
        <td class="p-3">${data.hari}</td>
        <td class="p-3 text-center">${data.jam}</td>
        <td class="p-3 text-center">${data.level}</td>
        <td class="p-3 text-center">${data.pengajar}</td>
        ${
          role === "admin"
          ? `<td class="p-3 text-center">
              <button onclick="hapusJadwal('${data.id}')" 
                class="bg-red-500 text-white px-3 py-1 rounded text-xs hover:bg-red-600">
                Hapus
              </button>
            </td>`
          : ""
        }
      </tr>
    `;
  });
}


// ================= TAMBAH JADWAL =================
window.tambahJadwal = async function() {
  const hari = document.getElementById("hariInput").value;
  const jam = document.getElementById("jamInput").value;
  const level = document.getElementById("levelInput").value;
  const pengajar = document.getElementById("pengajarInput").value;

  if (!hari || !jam || !level || !pengajar) {
    alert("Semua field wajib diisi!");
    return;
  }

  await addDoc(jadwalRef, { hari, jam, level, pengajar });

  // reset form
  document.getElementById("hariInput").value = "";
  document.getElementById("jamInput").value = "";
  document.getElementById("levelInput").value = "";
  document.getElementById("pengajarInput").value = "";

  loadJadwal();
};

// ================= HAPUS =================
window.hapusJadwal = async function(id) {
  if (confirm("Yakin ingin menghapus jadwal ini?")) {
    await deleteDoc(doc(db, "Jadwal", id));
    loadJadwal();
  }
};

loadJadwal();
</script>




<!-- ðŸ”‘ AUTH (LOGOUT) -->
<script src="assets/js/auth.js"></script>

</body>
</html>
